# FJNU_RM2026智能追踪飞镖系统 - 使用教程

## 目录
1. [系统准备](#1-系统准备)
2. [硬件连接](#2-硬件连接)
3. [软件配置](#3-软件配置)
4. [系统调试](#4-系统调试)
5. [操作流程](#5-操作流程)
6. [参数调整](#6-参数调整)
7. [常见问题](#7-常见问题)
8. [维护保养](#8-维护保养)

## 1. 系统准备

### 开发环境配置
- **安装Keil MDK 5**：用于程序编译与调试
- **安装STM32CubeMX**：用于配置STM32外设
- **安装STM32CubeProgrammer**：用于固件烧录

### 准备硬件
- STM32F401单片机开发板
- 2个舵机（推荐型号：MG996R或同等规格）
- 2个涵道电机（推荐型号：根据飞镖重量选择合适的推力）
- 电源系统（电池、稳压模块）
- 姿态传感器模块（如MPU6050）
- 视觉/目标识别系统（可选）
- ST-Link调试器

## 2. 硬件连接

### 舵机连接
- 左舵机：连接到TIM2通道1（PA0）
- 右舵机：连接到TIM2通道2（PA1）

### 电机连接
- 涵道电机1：连接到TIM3通道1（PA6）
- 涵道电机2：连接到TIM3通道2（PA7）

### 电源系统
- 舵机电源：5V供电
- 电机电源：通过电调供电，根据电机型号选择合适电压
- 主控电源：3.3V或5V（取决于开发板型号）

### 传感器连接
- MPU6050：连接到I2C1（SCL: PB6, SDA: PB7）
- 其他传感器根据实际需求连接

## 3. 软件配置

### 编译与烧录
1. 使用Keil MDK打开项目文件：`MDK-ARM/dart2.uvprojx`
2. 点击"Build"按钮编译项目
3. 连接ST-Link调试器
4. 点击"Download"按钮将固件烧录到STM32开发板

### 系统初始化参数
系统的初始参数在以下文件中配置：
- `dart_control.h`：基本控制参数定义
- `attitude_control.h`：姿态控制PID参数

## 4. 系统调试

### 串口调试
系统通过UART通信进行调试：
1. 连接USB转TTL模块到USART1（TX: PA9, RX: PA10）
2. 打开串口调试助手，设置波特率为115200，8N1
3. 系统运行后将输出调试信息

### 参数监控
串口输出的调试信息包含：
- 系统状态
- 姿态数据（Roll、Pitch、Yaw）
- 目标位置数据（X、Y、是否检测到）
- 控制输出值（舵机位置、电机推力）

## 5. 操作流程

### 上电前检查
1. 检查所有连接是否牢固
2. 确保电池电量充足
3. 飞镖机械结构是否完好

### 系统启动
1. 接通电源
2. 系统将进入初始化状态（`SYSTEM_INIT`）
3. 完成初始化后进入空闲状态（`SYSTEM_IDLE`）

### 目标追踪模式
1. 系统检测到目标信号后自动进入追踪状态（`SYSTEM_TARGETING`）
2. 飞镖姿态将自动调整，对准目标位置
3. 左右舵机将根据目标位置进行相应控制

### 攻击模式
1. 目标锁定后，可进入攻击状态（`SYSTEM_ATTACK`）
2. 涵道电机会提供推力，飞镖向目标方向飞行
3. 途中姿态控制系统将保持飞镖指向目标

## 6. 参数调整

### PID参数调整
在`attitude_control.h`文件中可调整PID参数：
```c
// 横滚控制参数
#define ROLL_KP  2.0f    // 增大可提高响应速度，但过大会导致振荡
#define ROLL_KI  0.05f   // 增大可减小静态误差，但过大会导致积分饱和
#define ROLL_KD  0.5f    // 增大可抑制振荡，但过大会放大噪声

// 俯仰控制参数
#define PITCH_KP  2.0f
#define PITCH_KI  0.05f
#define PITCH_KD  0.5f

// 偏航控制参数
#define YAW_KP  1.5f
#define YAW_KI  0.02f
#define YAW_KD  0.3f
```

### 舵机参数调整
在`attitude_control.h`文件中可调整舵机相关参数：
```c
#define SERVO_CENTER       1500    // 舵机中位值(微秒)
#define SERVO_TRAVEL       500     // 舵机行程(微秒)
```

### 电机参数调整
在`attitude_control.h`文件中可调整电机相关参数：
```c
#define MOTOR_IDLE         1100    // 电机怠速值(微秒)
#define MOTOR_MAX_THRUST   1800    // 电机最大推力值(微秒)
```

## 7. 常见问题

### 舵机抖动问题
- **可能原因**：PID参数不合适、PWM信号不稳定
- **解决方案**：
  1. 减小KP值和KD值
  2. 检查电源质量，确保电压稳定
  3. 检查接线是否松动

### 电机不转问题
- **可能原因**：信号线连接问题、电调未正确校准
- **解决方案**：
  1. 检查信号线连接
  2. 重新校准电调（参考电调说明书）
  3. 确认PWM频率设置正确

### 姿态数据异常
- **可能原因**：传感器故障、I2C通信问题
- **解决方案**：
  1. 检查传感器连接
  2. 校准传感器
  3. 排查I2C通信问题

### 系统无响应
- **可能原因**：程序异常、电源问题
- **解决方案**：
  1. 重启系统
  2. 检查电源电压
  3. 重新烧录固件

## 8. 维护保养

### 定期检查项目
- 电池电量监控：确保电池电压正常
- 舵机运动范围测试：确认无卡顿现象
- 电机推力测试：确认推力稳定
- 固件版本更新：及时更新最新固件

### 飞行前检查
- 舵面活动范围：确保舵面活动自如
- 电机启动测试：低速启动测试电机
- 姿态传感器校准：确保姿态数据准确

### 存储要求
- 存放环境：干燥、常温
- 电池处理：长期不用时取出电池
- 清洁要求：定期清理灰尘，保持散热良好

---

**注意**：本教程仅适用于FJNU_RM2026智能追踪飞镖系统，使用其他型号硬件可能需要调整相应参数。

**安全警告**：涵道电机高速旋转具有危险性，调试时请做好安全防护，避免人员靠近旋转部件。